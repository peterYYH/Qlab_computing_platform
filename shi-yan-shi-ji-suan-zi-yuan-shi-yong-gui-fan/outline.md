---
description: 作者：唐元博         时间：2020-4-19
---

# Outline

实验室目前共有六台常用服务器，由于使用计算资源的同学很多，同时因为各自科研需求不免需要搭建不同的环境，在日常使用中很容易出现软件环境冲突，最终造成多名同学均无法正常使用、甚至不得不重装系统等混乱的情况。更为麻烦的是倘若实验室内部沟通不畅，环境被干扰的同学可能完全摸不清原因何在，故而编写此文档，作为实验室内部使用服务器的约定，希望各位享受到实验室资源的同时可以携手建立良好的实验室团队工程习惯、氛围。

接下来我们主要对三个主要方面作出约定：软件环境、存储、端口。这些约定（或者说教训）都是来自于已经踩过的坑，各位同学若有所新的感悟或者更好的建议，欢迎指正和补充。

## 软件环境

在这一小节已经罗列了目前服务器上已经安装的软件版本，对于服务器来说，软件环境不到万不得已尽量不要作改动，因为更新、卸载软件均有可能会对其他依赖这些软件的同学造成影响，**我们建议优先使用容器环境部署自己的应用，或者使用conda创建专属于自己的python环境，来达到尽量与其他同学环境相隔离的效果**。

如果容器无法满足要求不得不在本地安装，**请先在大群中发布一下需要执行的操作**，与可能发生干扰的同学协商后方可安装，这样即使后来万一造成了干扰，也可第一时间排查原因，寻求解决之道。

另外，除了软件的改动，还有一些操作也会造成环境的紊乱。

首先是环境变量，有时设置环境变量可以快速解决问题，但是尽量不要改动现有的环境变量，很容易造成服务无法正常运行。

其次是服务器和docker环境的重启，很多同学的任务运行在容器中，重启会导致一些常驻容器被杀死，不在群中告知的话，一方面会影响一些同学正在运行中的任务，另一方面有的同学可能会过了很久才会突然发现自己的常驻服务不见了，倘若其中还有实验室对外提供的服务（如提供covid-19 web应用），会对用户造成不好的影响。

因此，在不得已进行这些操作的时候，同更改软件一样需要在群中告知，方便对应项目的维护者及时维护，避免造成麻烦。

## 存储

本地存储：服务器的存储空间不算小，但是考虑到镜像和数据动辄数G甚至数十G的磁盘占用量，假以时日亦会捉襟见肘。另外，目前大部分同学将临时的文件放在主目录下，因为服务器是实验室内共享的，很容易造成混乱，也增加了误删的可能。

![&#x7A0D;&#x663E;&#x6DF7;&#x4E71;&#x7684;&#x4E3B;&#x76EE;&#x5F55;](https://github.com/peterYYH/Qlab_computing_platform/tree/980bb64ec50ce521e87d75d7773895a118e920fb/.gitbook/assets/image%20%2853%29.png)

我们不妨如此操作：每一位同学在主目录下建立自己名称的文件夹，将私人文件放在其中，倘若有专门的项目便建立项目的文件夹（如图1中红框），尽量避免公用的目录成为临时文件、重要文件鱼龙混杂的场所。同时各自的目录定期予以清理，尽量减少磁盘占用。

分布式存储：在实验室的服务器上我们搭建了hdfs分布式文件系统，便于集群内任一节点、容器很方便地访问共享空间，同本地存储一样，我们建议同学们各自建立自己私人的、项目专有的文件夹，不把文件都放在主目录下。分布式文件系统的使用方法请参照github上关于hadoop的相关使用手册。

![&#x5206;&#x5E03;&#x5F0F;&#x5B58;&#x50A8;&#x7684;web&#x754C;&#x9762;](../.gitbook/assets/image%20%281%29.png)

## 端口

当需要向外部提供服务，便不得不选择端口暴露，六台服务器端口众多，本地服务、集群服务占用的端口为数众多，又不断在变化，一一列举恐力所不能。我们建议在需要使用端口的时候，先使用Linux的端口查询命令检查即将使用的端口是否已经被其他程序所占用，倘若已经被占用，烦请另选端口。

![Linux&#x7AEF;&#x53E3;&#x67E5;&#x8BE2;&#x547D;&#x4EE4;](https://github.com/peterYYH/Qlab_computing_platform/tree/980bb64ec50ce521e87d75d7773895a118e920fb/.gitbook/assets/image%20%2813%29.png)

感谢您的阅读，希望各位享受到实验室资源的同时，可以携手建立良好的实验室团队工程习惯、氛围，上述提出的约定都是来自于已经踩过的大坑所引发的思考，各位同学若有所新的感悟或者更好的建议，欢迎指正和补充。另外，目前实验室集群、系统、常用软件主要由唐元博、郜泽飞维护，如果遇到了疑惑不妨与他们联系。

